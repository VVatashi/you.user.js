// ==UserScript==
// @name        (You)
// @include     *
// @version     0.1.4
// @grant       GM_getValue
// @grant       GM_setValue
// @require     http://code.jquery.com/jquery-3.1.1.min.js
// @run-at      document-end
// @namespace   https://github.com/VVatashi
// @downloadURL https://raw.githubusercontent.com/VVatashi/-You-/master/build/you.user.js
// @updateURL   https://raw.githubusercontent.com/VVatashi/-You-/master/build/you.user.js
// ==/UserScript==
!function(){function t(){d=JSON.parse(GM_getValue(i,JSON.stringify(d)))}function n(){GM_setValue(i,JSON.stringify(d))}function e(){var t=document.createElement("style");t.type="text/css",t.innerHTML="\n."+s+d.myPostStyle+"\n\n."+p+d.replyPostStyle+"\n\n."+u+d.replyLinkStyle+"\n\nform."+c+" {\n    position: absolute;\n    background-color: white;\n    box-shadow: 0px 2px 6px 0px rgba(97,107,134,.8);\n    padding: 12px 16px;\n    z-index: 1;\n    min-width: 30%;\n}\n\nform."+c+" table, form."+c+" p {\n    color: black;\n    background-color: white;\n    width: 100%;\n}\n\nform."+c+" tr, form."+c+" textarea {\n    width: 100%;\n}",document.head.appendChild(t)}function a(){var t="you-config-name",e="you-config-trip",a="you-config-mypost-style",r="you-config-replypost-style",o="you-config-replylink-style",i="you-config-toogle",s="you-config-save",p="you-config-default",u=$(".adminbar, #adminbar, .boardlist, .menu, .board-list").first();u.after('\n[ <a class="'+i+'">(You) config</a> ]\n<br />\n<form class="'+c+'">\n    <table>\n        <tr><td>Name:</td><td><input type="text" class="'+t+'" value="'+d.name+'" /></td></tr>\n        <tr><td>Trip:</td><td><input type="text" class="'+e+'" value="'+d.trip+'" /></td></tr>\n        <tr><td>My post css:</td><td><textarea class="'+a+'">'+d.myPostStyle+'</textarea></td></tr>\n        <tr><td>Reply post css:</td><td><textarea class="'+r+'">'+d.replyPostStyle+'</textarea></td></tr>\n        <tr><td>Reply link css:</td><td><textarea class="'+o+'">'+d.replyLinkStyle+'</textarea></td></tr>\n        <tr><td colspan="2"><button class="'+s+'">Save</button><button class="'+p+'">Restore defaults</button></td></tr>\n    </table>\n    <p>Reload page to apply changes.</p>\n</form>\n'),$("a."+i).click(function(){return $("form."+c).toggle(),!1}),$("button."+s).click(function(){return d.name=$("input."+t).val(),d.trip=$("input."+e).val(),d.myPostStyle=$("textarea."+a).val(),d.replyPostStyle=$("textarea."+r).val(),d.replyLinkStyle=$("textarea."+o).val(),n(),!1}),$("button."+p).click(function(){return d=l,$("input."+t).val(d.name),$("input."+e).val(d.trip),$("textarea."+a).val(d.myPostStyle),$("textarea."+r).val(d.replyPostStyle),$("textarea."+o).val(d.replyLinkStyle),n(),!1}),$("form."+c).hide()}function r(){for(var t=0;t<y.length;t++)if(window.location.hostname.indexOf(y[t])!=-1)return!0;return!1}function o(){var t=$(f).not(v),n=t.filter(function(t,n){var e=$(n).find(x).text(),a=$(n).find(m).text();return e.indexOf(d.name)!=-1&&a.indexOf(d.trip)!=-1});n.addClass(s);var e=$.map(n,function(t,n){return $(t).attr("id").match(/\d+/)[0]});g=g.concat(e);var a=t.filter(function(t,n){for(var e=$(n).find(h).text(),a=0;a<g.length;a++)if(e.indexOf(">>"+g[a])!=-1)return!0;return!1});a.addClass(p),a.find(h).find("a").each(function(t,n){for(var e=$(n).text(),a=0;a<g.length;a++)if(e==">>"+g[a])return void $(n).addClass(u)}),t.addClass(b)}var i="you-config",l={name:"Name",trip:"!Trip",myPostStyle:"{ box-shadow: 6px 0 2px -2px rgba(97,107,134,.8), -6px 0 2px -2px rgba(97,107,134,.8); }",replyPostStyle:"{ box-shadow: 6px 0 2px -2px rgba(97,134,107,.8), -6px 0 2px -2px rgba(97,134,107,.8); }",replyLinkStyle:":after { content: ' (You)'; }"},d=l,c="you-config-form",s="you-post-my",p="you-post-reply",u="you-post-reply-link",y=["2ch.hk","dobrochan.com","iichan.hk","syn-ch.com","2-ch.su","nowere.net","410chan.org","kurisa.ch","chuck.dfwk.ru","owlchan.ru","haibane.ru","volgach.ru","hohoemy.exach.com","zerochan.ru","haruhichan.ovh","chaos.cyberpunk.us","02ch.in","ozuchan.ru","dvach.hut2.ru","2watch.su"],f="td.reply[id], div.reply[id], td.post[id], div.post[id], div.thread_OP[id], div.thread_reply[id]",h="blockquote, .body, .postbody, .post_body",x=".postername, .name, .commentpostername, .poster-name",m=".postertrip, .trip, .tripcode",b="you-processed",v="."+b,g=[];$(document).ready(function(){r()&&(t(),e(),a(),o(),setInterval(o,1e4))})}();